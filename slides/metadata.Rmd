---

---

## What is Metadata?

Metadata is the information needed for someone else to understand and use your data.  It is the Who, What, When, Where, Why, and How about your data.  

This includes _package-level_ and _file-level_ metadata.  

===

### Common components of metadata

Package-level:
 - Data creator 
 - Geographic and temporal extents of data (generally)
 - Funding source
 - Licensing information (Creative Commons, etc.)
 - Publication date

===

File-level:
 - Define variable names
 - Describe variables (units, etc.)
 - Define allowed values for a variable
 - Describe file formats

===

### Metadata Standards

The goal is to have a machine and human readable description of your data. 
 
Metadata standards create a structural expression of metadata necessary to document a data set.  
This can mean using a controlled set of descriptors for your data specified by the standard. 

===

Without metadata standards, your digital data may be irretrievable, unidentifiable or unusable. 
Metadata standards contain definitions of the data elements and standardized ways of representing them in digital formats such as databases and XML (eXtensible Markup Language).
{:.notes}

These standards ensure consistent structure that facilitates data sharing and searching, record provenance and technical processes, and manage access permissions.  Recording metadata in digital formats such as XML ensures effective machine searches through consistent structured data entry, and thesauri using controlled vocabularies.  
{:.notes}

===

Metadata standards are often developed by user communities.  

For example, the Ecological Metadata Language, EML, is a standard developed by ecologists to document environmental and ecological data. EML is a set of XML schema documents that allow for the structural expression of metadata. To learn more about EML check out their [site](https://eml.ecoinformatics.org).
{:.notes}

Therefore, the standards can vary between disciplines and types of data.  

===

![]({% include asset.html path="images/standards_xkcd.png" %}){: width="75%"} 

===

Some examples include:

   - General: [Dublin Core](http://dublincore.org/)
   - Ecological/Environmental/Biological: [EML](https://www.dcc.ac.uk/resources/metadata-standards/eml-ecological-metadata-language), [Darwin Core](https://dwc.tdwg.org/)
   - Social science: [DDI](http://www.ddialliance.org/), [EAD](https://www.loc.gov/ead/) 
   - Geospatial/Meterological/Oceanographic: [ISO 19115](https://www.iso.org/standard/53798.html), [COARDS Conventions](https://ferret.pmel.noaa.gov/Ferret/documentation/coards-netcdf-conventions)

===

### Creating metadata

Employer-specific mandated methods

For example, some government agencies specify the metadata standards to which their employees must adhere.  

===

Repository-specific methods

Repository websites frequently guide you through metadata creation during the process of uploading your data.  
{:.notes}

   - website for metadata entry on the [Knowledge Network for Biocomplexity](https://knb.ecoinformatics.org) repository 
     ![]({% include asset.html path="images/knb_snap.PNG" %}){: width="100%"} 

===     
   
Stand-alone software

Software designed for data curation may have more features and options.     
{:.notes}
   
   - [Data Curator](https://github.com/qcif/data-curator) 
     This software from the [Queensland Cyber Infratstructure Foundation](https://www.qcif.edu.au/) supports metadata creation, provenance, and data packaging.
     ![]({% include asset.html path="images/Data_Curator_snap.PNG" %}){: width="100%"} 
     
   - [ezEML](https://ezeml.edirepository.org/eml/user_guide)
     This software from the [Environmental Data Initiative](https://environmentaldatainitiative.org/) supports metadata creation, metadata editing, and multiple metadata co-authors.
     ![]({% include asset.html path="images/ezEML_capture.PNG" %}){: width="100%"} 
     
===

Coding 

Many methods for documenting and packaging data are also available in R packages developed by repository managers.  For example, `EMLassemblyline` was developed by the [Environmental Data Initiative](https://environmentaldatainitiative.org/) to facilitate documenting data in EML, and preparing data for publication.          
{:.notes}

   - R packages for metadata ([EML](){:.rlib}, [dataspice](https://github.com/ropenscilabs/dataspice), [emld](){:.rlib}),
   [EMLassemblyline](https://ediorg.github.io/EMLassemblyline/)
 
===

### Example of coding up some metadata  

| R Package         | What does it do?                                           |
|-------------------+------------------------------------------------------------|
| `EMLassemblyline` | creates high quality EML metadata for packaging data       |
| `EML`             | creates EML metadata files                                 |

===

We'll use the [EMLassemblyline](https://ediorg.github.io/EMLassemblyline/) package to create metadata in the EML metadata standard. 

```{r, eval = FALSE, message = FALSE, handout = 0}
library(EMLassemblyline) 
```

===

Create the organization for the data package with the `EMLassemblyline::template_directories()` function.

- **data_objects** A directory of data and other digital objects to be packaged (e.g. data files, scripts, .zip files, etc.).
- **metadata_templates** A directory of EMLassemblyline template files.
- **eml** A directory of EML files created by EMLassemblyline.
- **run_EMLassemblyline.R** An R file for scripting an EMLassemblyline workflow.


```{r, eval = FALSE, handout = 0}
template_directories(path = ".", dir.name = "storm_project") # create template files in a new directory

# move the derived data file to the new storm_project directory
file.copy("StormEvents_d2006.csv", "./storm_project/data_objects/", overwrite = TRUE)
file.remove("StormEvents_d2006.csv")
```
 
Look at your storm_project folder, and see the template files and folders, and the derived data file we created earlier. 
 
=== 

### Describe the package-level metadata. 

We'll start by creating the package-level metadata. 

Essential metadata: Create templates for package-level metadata, including abstract, intellectual rights, keywords, methods, personnel, and additional info.  These are required for all data packages.

```{r}
template_core_metadata(path = "./storm_project/metadata_templates",
                       license = "CCBY",
                       file.type = ".md")
```

We've chosen the "CCBY" license and the markdown file type (`.md`).  Markdown files are text files that are easily edited in RStudio.  Try opening the `abstract.md` file (in the `./storm_project/metadata_templates/` folder) and adding a brief abstract.  
{:.notes}

You can choose the license you wish to apply to your data (["CC0"](https://creativecommons.org/publicdomain/zero/1.0/) or ["CCBY"](https://creativecommons.org/licenses/by/4.0/)), as well as the file type of the metadata (`.txt`, `.docx`, or `.md`).
See the [help page for the function](https://ediorg.github.io/EMLassemblyline/reference/template_core_metadata.html) for more information. 
NOTE: The `.txt` template files are Tab delimited. 
{:.notes}

===

Geographic coverage: Create the metadata for the geographic extent.

```{r, eval = FALSE, handout = 0}
template_geographic_coverage(path = "./storm_project/metadata_templates", 
                             data.path = "./storm_project/data_objects", 
                             data.table = "StormEvents_d2006.csv", 
                             lat.col = "BEGIN_LAT",
                             lon.col = "BEGIN_LON",
                             site.col = "STATE"
                             )
```

===

Now that the templates have been created, open the files and add the appropriate metadata.  They are located in the project directory, the metadata templates folder `./storm_project/metadata_templates/`.  

NOTE: The `.txt` template files are Tab delimited. 

===
  
### Describe the file-level metadata.

Now that we've created package-level metadata, we can create the file-level metadata.  
  
Data attributes: Create table attributes template (required when data tables are present)

```{r, eval = FALSE, handout = 0}
template_table_attributes(path = "./storm_project/metadata_templates",
                          data.path = "./storm_project/data_objects",
                          data.table = c("StormEvents_d2006.csv"))
```

===

The template function can't discover everything, so some columns are still empty. Open the file in the metadata templates folder `./storm_project/metadata_templates/` to enter the missing info.  

You could open the text file in RStudio and edit manually, export it to Excel or Word and edit it, but let's read it into R and edit it here.  
{:.notes}

```{r, eval = FALSE, handout = 0}
attrib <- read.table("./storm_project/metadata_templates/attributes_StormEvents_d2006.txt", 
                     sep = "\t", header = TRUE)  # read in the attributes template text file
```

===

We need to add attribute definitions for each column, and units or date/time specifications for numeric or date/time columns classes.

```{r, eval = FALSE, handout = 0}
attributeDef <- c("event id number", "State", "FIPS code for state", "year",
                  "month", "type of event", "date event started", "timezone", 
                  "date event ended", "injuries as direct result of storm",
                  "injuries as indirect result of storm", 
                  "deaths - direct result", "deaths - indirect result", 
                  "property damage", "crop damage", "source of storm info",
                  "manitude of damage", "type of magnitude",
                  "beginning latitude", "beginning longitude", "ending latitude",
                  "ending longitude", "narrative of the episode", 
                  "narrative of the event", "source of the data")

units <- c("integer","","FIPS","","","","","","","injury","injury","death",
           "death","","","","score","","decimal degrees",
           "decimal degrees","decimal degrees","decimal degrees","","","")

datetime <- c("","","","YYYY","","","MM/DD/YYYY HH:MM",
              "three letter time zone","MM/DD/YYYY HH:MM",
              "","","","","","","","","","","","","","","","")

attrib <- attrib %>% mutate(attributeDefinition = attributeDef,
                            unit = units,
                            dateTimeFormatString = datetime)

write.table(attrib, "./storm_project/metadata_templates/attributes_StormEvents_d2006.txt", row.names = FALSE, sep = "\t")
```

===

Because we have categorical variables in our data file, we need to define those variables further using the following templating function. 

Categorical variables: Create metadata specific to categorical variables (required when the attribute metadata contains variables with a "categorical" class)

```{r}
template_categorical_variables(path = "./storm_project/metadata_templates", 
                               data.path = "./storm_project/data_objects")
```

===

NOTE: If you have not filled in the table attributes template completely, the  `template_categorical_variables()` function will produce errors.  It also produces a useful warning message that you can use to look at the issues.  

```{r, eval = FALSE}
Warning message:
Input issues found. Use issues() to see them. 
```

===

If you type `issues()` in your R console, you'll get helpful info on which issues you need to fix: 

```{r, eval = FALSE}
issues()
```

===

### Write EML metadata file

Many repositories for environmental data use EML (Ecological Metadata Language) formatting for metadata.  The function `make_eml()` converts the text files we've been editing into EML document(s).

```{r, eval = FALSE, message = FALSE, handout = 0}
make_eml(path = "./storm_project/metadata_templates",
         data.path = "./storm_project/data_objects",
         eml.path = "./storm_project/eml",
         dataset.title = "Storm Events 2006",
         temporal.coverage = c("2006-01-01", "2006-04-07"),
         maintenance.description = "In Progress: Some updates to these data are expected")
```

===
