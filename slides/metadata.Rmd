---

---

## What is Metadata?

Metadata is the information needed for someone else to understand and use your data.  It is the Who, What, When, Where, Why, and How about your data.  

This includes _package-level_ and _file-level_ metadata.  

===

### Common components of metadata

Package-level:
 - Data creator 
 - Geographic and temporal extents of data (generally)
 - Funding source
 - Licensing information (Creative Commons, etc.)
 - Publication date

===

File-level:
 - Define variable names
 - Describe variables (units, etc.)
 - Define allowed values for a variable
 - Describe file formats

===

### Metadata Standards

The goal is to have a machine and human readable description of your data. 
 
Metadata standards create a structural expression of metadata necessary to document a data set.  
This can mean using a controlled set of descriptors for your data specified by the standard. 

===

Without metadata standards, your digital data may be irretrievable, unidentifiable or unusable. 
Metadata standards contain definitions of the data elements and standardized ways of representing them in digital formats such as databases and XML (eXtensible Markup Language).
{:.notes}

These standards ensure consistent structure that facilitates data sharing and searching, record provenance and technical processes, and manage access permissions.  Recording metadata in digital formats such as XML ensures effective machine searches through consistent structured data entry, and thesauri using controlled vocabularies.  
{:.notes}

===

Metadata standards are often developed by user communities.  

For example, the Ecological Metadata Language, EML, is a standard developed by ecologists to document environmental and ecological data. EML is a set of XML schema documents that allow for the structural expression of metadata. To learn more about EML check out their [site](https://eml.ecoinformatics.org).
{:.notes}

Therefore, the standards can vary between disciplines and types of data.  

===

![]({% include asset.html path="images/standards_xkcd.png" %}){: width="75%"} 

===

Some examples include:

   - General: [Dublin Core](http://dublincore.org/)
   - Ecological/Environmental/Biological: [EML](https://www.dcc.ac.uk/resources/metadata-standards/eml-ecological-metadata-language), [Darwin Core](https://dwc.tdwg.org/)
   - Social science: [DDI](http://www.ddialliance.org/), [EAD](https://www.loc.gov/ead/) 
   - Geospatial/Meterological/Oceanographic: [ISO 19115](https://www.iso.org/standard/53798.html), [COARDS Conventions](https://ferret.pmel.noaa.gov/Ferret/documentation/coards-netcdf-conventions)

===

### Creating metadata

Employer-specific mandated methods

For example, some government agencies specify the metadata standards to which their employees must adhere.  

===

Repository-specific methods

Repository websites frequently guide you through metadata creation during the process of uploading your data.  
{:.notes}

   - website for metadata entry on the [Knowledge Network for Biocomplexity](https://knb.ecoinformatics.org) repository 
     ![]({% include asset.html path="images/knb_snap.PNG" %}){: width="100%"} 

===     
   
Stand-alone software

Software designed for data curation often has more features and options.  This software from the [Queensland Cyber Infratstructure Foundation](https://www.qcif.edu.au/) supports metadata creation, provenance, and data packaging.    
{:.notes}
   
   - [Data Curator](https://github.com/qcif/data-curator)
     ![]({% include asset.html path="images/Data_Curator_snap.PNG" %}){: width="100%"} 
     
===

Coding 

Many methods for documenting and packaging data are also available in R packages developed by repository managers.  For example, `EMLassemblyline` was developed by the [Environmental Data Initiative](https://environmentaldatainitiative.org/) to facilitate documenting data in EML, and preparing data for publication.          
{:.notes}

   - R packages ([EML](){:.rlib}, [dataspice](https://github.com/ropenscilabs/dataspice), [emld](){:.rlib}),
   [EMLassemblyline](https://ediorg.github.io/EMLassemblyline/)
 
===

### Example of coding up some metadata  

| R Package         | What does it do?                                           |
|-------------------+------------------------------------------------------------|
| `EMLassemblyline` |                                                            |
| `EML`             | creates EML metadata files                                 |

===

We'll use the [dataspice](https://github.com/ropenscilabs/dataspice) package to create metadata in the EML metadata standard. 

```{r, eval = FALSE, message = FALSE, handout = 0}
library(EMLassemblyline) 
```

===

Create the organization for the data package.

- **data_objects** A directory of data and other digital objects to be packaged (e.g. data files, scripts, .zip files, etc.).
- **metadata_templates** A directory of EMLassemblyline template files.
- **eml** A directory of EML files created by EMLassemblyline.
- **run_EMLassemblyline.R** An R file for scripting an EMLassemblyline workflow.


```{r, eval = FALSE, handout = 0}
template_directories(path = ".", dir.name = "storm_project") # create template files

# move derived data file to new storm_project directory
file.copy("StormEvents_d2006.csv", "./storm_project/data_objects/", overwrite = TRUE)
file.remove("StormEvents_d2006.csv")
```
 
Look at your storm_project folder, and see the template files and folders, and the derived data file we created earlier. 
 
=== 

### Describe the package-level metadata. 

We'll start by creating the package-level metadata. 

Essential metadata: Create templates for package-level metadata, including abstract, intellectual rights, keywords, methods personnel, and additional info.  These are required for all data packages.

```{r}
template_core_metadata(path = "./storm_project/metadata_templates",
                       license = "CCBY",
                       file.type = ".md")
```

Geographic coverage: Create the metadata for the geographic extent.

```{r, eval = FALSE}
template_geographic_coverage(path = "./storm_project/metadata_templates", 
                             data.path = "./storm_project/data_objects", 
                             data.table = "StormEvents_d2006.csv", 
                             lat.col = "BEGIN_LAT",
                             lon.col = "BEGIN_LON",
                             site.col = "STATE"
                             )
```

===

Now that the templates have been created, open the files and add the appropriate metadata.  They are located in the project directory, the metadata templates folder `./storm_project/metadata_templates/`.  

===
  
### Describe the file-level metadata.

Now that we can create the file-level metadata.  
  
Data attributes: Create table attributes template (required when data tables are present)

```{r}
template_table_attributes(path = "./storm_project/metadata_templates",
                          data.path = "./storm_project/data_objects",
                          data.table = c("StormEvents_d2006.csv"))
```


# Create categorical variables template (required when attributes templates
# contains variables with a "categorical" class)

template_categorical_variables(
  path = path_templates, 
  data.path = path_data)




===
  

===


===

=== 

===



The `prep_attributes()` function tries also to discover the metadata for itself.  

```{r, eval = FALSE, handout = 0}
prep_attributes(data_path = "storm_project",
                attributes_path = "storm_project/metadata/attributes.csv")  
```
  
===  
  
The `edit_attributes()` function can be used to further edit the file attribute metadata.    
  
```{r, eval = FALSE, handout = 0}
edit_attributes(metadata_dir = "storm_project/metadata")
```

===

### Write metadata file

Now we can write our metadata to a json-ld file.

```{r, eval = FALSE, handout = 0}
write_spice(path = "storm_project/metadata")
```

===

You can also create a static website for your dataset.

```{r, eval = FALSE, warning = FALSE, handout = 0}
build_site(path = "storm_project/metadata/dataspice.json")
```

Your site will build to the location "docs/index.html".
{:.notes}

===

Many repositories for environmental data use EML (Ecological Metadata Language) formatting for metadata.  
Now you can convert the json-ld metadata created by dataspice into EML format.  Not 
everything will convert perfectly, so it is important to validate the EML.  

```{r, eval = FALSE, message = FALSE, handout = 0}

library(EML)

eml_doc <- spice_to_eml("storm_project/metadata/dataspice.json")

EML::eml_validate(eml_doc) # check the converted metadata for missing EML 
```

===



```{r, eval = FALSE, message = FALSE, handout = 0}




write_eml(eml_doc, "storm_project/metadata/dataspice.xml")




```

===
